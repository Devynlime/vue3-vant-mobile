# Changelog

## [v1.0.14]

### 重构

- 将通道检测页面的搜索树组件抽取为独立组件 `ChannelTree.vue`
- 优化了组件的结构，提高了代码的可维护性和复用性

### 改进

- 添加了组件 Props 和 Emits 的类型定义
- 优化了移动端适配
- 改进了组件间的通信方式

### 待优化

- 考虑添加 TypeScript 支持
- 可以考虑将树节点数据缓存到 Vuex/Pinia 中
- 添加加载状态显示
- 优化树节点的搜索性能
- 考虑添加节点选择的历史记录功能

### Added

- 添加 ESLint 配置，使用 @antfu/eslint-config 作为基础配置。

### Todo

- [ ] 为 getCodeImg API 响应添加正确的类型定义
- [ ] 完善 API 响应的类型系统

### Added

- 🔒 集成 js-cookie 库增强用户认证功能

  - 添加 js-cookie 依赖到 package.json
  - 实现基于 cookie 的 token 管理机制
  - 新增验证码获取和验证功能
  - 优化登录流程，增加验证码校验步骤
- 🎨 用户界面优化

  - 登录页面新增验证码输入模块
  - 优化通道检测页面的交互体验
  - 改进用户信息展示方式
- ���加请求防重复提交功能，避免用户重复点击导致的多次提交

  - 在工单确认时增加防重复提交保护
  - 在告警配置保存时增加防重复提交保护
  - 在视频监控切换时增加防重复提交保护

### Changed

- 📦 依赖更新

  - 新增 js-cookie: ^x.x.x（具体版本号）
- 🔄 用户认证流程优化

  - 重构 token 管理逻辑，使用 js-cookie 统一管理
  - 完善用户信息状态管理
  - 增强登录安全性，添加验证码校验
- 优化 `EchartMap.vue` 组件的地图渲染逻辑，使用 `nextTick` 确保 DOM 更新后再初始化图表
- 改进地图数据加载机制，使用 `Promise.all` 并行加载数据，提升加载效率
- 完善错误处理机制，添加完整的错误捕获和提示
- 优化树形控件的展开逻辑

  - 修改默认展开行为，只展开第一层节点
  - 移除自动展开子节点的逻辑
  - 简化了节点初始化过程

### Fixed

- 修复地图无法填满容器的问题，通过正确设置容器尺寸和使用 `nextTick` 解决
- 优化了地图组件的响应式布局表现
- 修复了可能导致重复提交的问题，增加了请求节流保护
- 修复登录页面的 TypeScript 类型检查警告
- 为 @ts-expect-error 添加必要的说明注释
- 修复树形控件首次加载时子列表未自动加载的问题
  - 优化了节点初始化和加载逻辑
  - 添加了 initializeTree 函数统一处理初始展开逻辑
  - 移除了可能导致时序问题的 setTimeout 调用
  - 添加了 expand-on-click-node 属性优化交互体验
- 修复了 BaiduChannelMap 组件在卸载时的错误，替换了不存在的 destroy 方法，改用正确的清理流程
- 添加了更完整的地图资源清理步骤，防止内存泄漏

### Security

- 🔐 增强用户认证安全性
  - 添加验证码机制防止暴力破解
  - 优化 token 存储方式，增加安全性
  - 完善

### Technical Debt

- 考虑添加加载状态指示器，提升用户体验
- 可以考虑将树形控件的初始化逻辑抽离为独立的 composable
- 建议添加错误边界处理，防止加载失败时的异常状态
